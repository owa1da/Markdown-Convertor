<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Markdown to DOC Converter</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500" />
    <style>
      * { box-sizing: border-box; }
      body {
        margin: 0; padding: 0; font-family: "Roboto", sans-serif;
        background: #f5f7fa; display: flex; align-items: center; justify-content: center; min-height: 100vh;
      }
      .container {
        width: 90%; max-width: 800px; background: #fff; padding: 2rem; border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,.1);
      }
      h1 { text-align: center; color: #333; margin-bottom: 1rem; }
      textarea {
        width: 100%; height: 200px; padding: 1rem; font-size: 16px; border: 1px solid #ddd; border-radius: 5px;
        resize: vertical; outline: none; transition: border-color .3s ease;
      }
      textarea:focus { border-color: #007bff; }
      .buttons { text-align: center; margin: 1rem 0; }
      button {
        background: #007bff; color: #fff; border: 0; padding: .75rem 1.5rem; font-size: 16px; border-radius: 5px; cursor: pointer;
        margin: 0 .5rem; transition: background .3s ease, transform .2s ease;
      }
      button:disabled { background: #aaa; cursor: not-allowed; }
      button:hover:not(:disabled) { background: #0056b3; transform: translateY(-1px); }
      .button-success { background: #28a745 !important; transform: scale(1.02); }
      #preview {
        border: 1px solid #ddd; padding: 1rem; border-radius: 5px; background: transparent; min-height: 150px; margin-top: 1rem; overflow: auto;
      }
      .instruction { font-size: 14px; text-align: center; color: #666; margin-top: 1rem; }
      table { width: 100%; border-collapse: collapse; border: 1px solid #000; }
      th, td { border: 1px solid #000; padding: 8px; text-align: left; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Markdown to DOC Converter</h1>
      <textarea id="markdownInput" placeholder="Paste your markdown here"></textarea>
      <div class="buttons">
        <button id="convertBtn">Convert</button>
        <button id="copyBtn" disabled>Copy to Clipboard</button>
        <button id="downloadBtn" disabled>Download as DOC</button>
      </div>
      <p class="instruction">Preview (you can copy this content and paste it into Google Docs or Microsoft Word)</p>
      <div id="preview" contenteditable="true"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      const convertBtn = document.getElementById("convertBtn");
      const copyBtn = document.getElementById("copyBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const markdownInput = document.getElementById("markdownInput");
      const preview = document.getElementById("preview");

      function convertMarkdown() {
        const markdownText = markdownInput.value;
        const rawHtml = marked.parse(markdownText, { breaks: true });

        const tmp = document.createElement("div");
        tmp.innerHTML = rawHtml;

        // Style tables
        tmp.querySelectorAll("table").forEach(t => {
          t.style.width = "100%";
          t.style.borderCollapse = "collapse";
          t.style.border = "1px solid #000";
        });
        tmp.querySelectorAll("th").forEach(th => {
          th.style.padding = "8px";
          th.style.textAlign = "left";
          th.style.background = "#f1f1f1";
          th.style.border = "1px solid #000";
        });
        tmp.querySelectorAll("td").forEach(td => {
          td.style.padding = "8px";
          td.style.textAlign = "left";
          td.style.border = "1px solid #000";
        });

        // Block code: remove background, keep border
        tmp.querySelectorAll("pre > code").forEach(codeEl => {
          const pre = codeEl.parentElement;
          const wrapper = document.createElement("div");
          wrapper.setAttribute("dir", "auto");
          wrapper.style.cssText =
            "border:1px solid #cccccc;padding:12px;margin:12px 0;" +
            "font-family:'Courier New',Consolas,monospace;font-size:12px;line-height:1.4;" +
            "white-space:pre-wrap;overflow-x:auto;border-radius:4px;background:transparent;";

          const newCode = document.createElement("code");
          newCode.style.cssText = "background:transparent;padding:0;font-family:inherit;font-size:inherit;white-space:pre-wrap;";
          newCode.textContent = codeEl.textContent;

          wrapper.appendChild(newCode);
          pre.replaceWith(wrapper);
        });

        // Inline code: remove background, keep border
        tmp.querySelectorAll("code").forEach(c => {
          if (!c.closest("div[style*='border:1px solid #cccccc']")) {
            c.style.background = "transparent";
            c.style.padding = "2px 4px";
            c.style.fontFamily = "'Courier New',Consolas,monospace";
            c.style.fontSize = "12px";
            c.style.borderRadius = "2px";
            c.style.border = "1px solid #ddd";
          }
        });

        preview.innerHTML = "";
        preview.appendChild(tmp);

        copyBtn.disabled = false;
        downloadBtn.disabled = false;
      }

      convertBtn.addEventListener("click", convertMarkdown);

      copyBtn.addEventListener("click", async () => {
        const html = preview.innerHTML;
        const plain = preview.innerText;
        const originalText = copyBtn.textContent;

        copyBtn.textContent = "Copying...";
        copyBtn.disabled = true;

        try {
          if (navigator.clipboard?.write) {
            const item = new ClipboardItem({
              "text/html": new Blob([html], { type: "text/html" }),
              "text/plain": new Blob([plain], { type: "text/plain" })
            });
            await navigator.clipboard.write([item]);
          } else {
            const range = document.createRange();
            range.selectNode(preview);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            if (!document.execCommand("copy")) throw new Error("Copy command failed");
            sel.removeAllRanges();
          }

          copyBtn.textContent = "Copied!";
          copyBtn.classList.add("button-success");
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove("button-success");
            copyBtn.disabled = false;
          }, 1500);
        } catch (err) {
          console.error(err);
          copyBtn.textContent = "Copy Failed";
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.disabled = false;
          }, 1500);
        }
      });

      downloadBtn.addEventListener("click", () => {
        const html = preview.innerHTML;
        const header = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office'
              xmlns:w='urn:schemas-microsoft-com:office:word'
              xmlns='http://www.w3.org/TR/REC-html40'>
          <head><meta charset='utf-8'><title>Exported Document</title></head>
          <body>`;
        const footer = "</body></html>";
        const sourceHTML = header + html + footer;

        const blob = new Blob(["\ufeff", sourceHTML], { type: "application/msword" });
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "document.doc";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    </script>
  </body>
</html>
